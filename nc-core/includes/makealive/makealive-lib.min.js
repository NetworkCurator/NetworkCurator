/** 
 * makealive.js
 * 
 * Make html alive with javascript
 * 
 * Author: Tomasz Konopka
 * 
 */var makealive={};makealive.lib={},makealive.types=[],document.addEventListener("DOMContentLoaded",function(){makealive.types=[];for(var e in makealive.lib)makealive.lib.hasOwnProperty(e)&&typeof makealive["lib"][e]=="function"&&makealive.types.push(e)}),makealive.clearTypes=function(){makealive.types=[]},makealive.addType=function(e,t){this.types.indexOf(e)<0&&this.types.push(e),this.lib[e]=t},makealive.setTypes=function(e){this.clearTypes();for(var t in e)e.hasOwnProperty(t)&&this.addType(t,e[t])},makealive.convert=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("pre code.makealive");for(var r=0;r<n.length;r++){var i=n[r],s=i.parentNode,o=null;for(var u=0;u<makealive.types.length;u++){var a=makealive.types[u];i.classList.contains(a)&&(o=a)}o!=null&&typeof this["lib"][o]!="function"&&(s.innerHTML+="\nmakealive error: undeclared function "+o,o=null);if(o!=null)try{var f=JSON.parse(i.innerHTML)}catch(l){s.innerHTML+="\nmakealive error: cannot parse JSON",o=null}if(o!=null){var c=document.createElement("div");c.className+="makealive";try{this.lib[o](c,f),s.parentNode.replaceChild(c,s)}catch(l){s.innerHTML+="\nmakealive error during conversion: "+l}}}return t},makealive.checkArguments=function(e,t){var n="";for(var r=0;r<t.length;r++)t[r]in e||(n+=" "+t[r]);return n},makealive.fillArguments=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=t[n]));return e},makealive.lib.barplot02=function(e,t){var n=makealive.checkArguments(t,["title","xlab","ylab","data"]);if(n!="")throw"missing arguments: "+n;var r={size:[360,200],margin:[70,20,30,50],offset:["-3.3em","-2.0em","-2em"],padding:.2};makealive.fillArguments(t,r);for(var i=0;i<4;i++)t.margin[i]=+t.margin[i];var s=+t.size[0],o=+t.size[1],u=o-t.margin[0]-t.margin[2],a=s-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+s+"px; height: "+o+"px");var f=d3.select(e).append("svg").attr("width",s+"px").attr("height",o+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")");f.append("text").html(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0);var l=t.data.map(function(e){return e.value});f.append("text").html(t.xlab).style("text-anchor","left").attr("y",0).attr("dy",t.offset[1]).attr("x",0);var c=d3.scaleLinear().range([0,a]).domain([0,Math.max.apply(null,l)]),h=d3.axisTop(c).ticks(5);f.append("g").attr("transform","translate(0,0)").call(h),f.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(o-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").html(t.ylab);var p=d3.scaleBand().range([0,u]).padding(t.padding).domain(t.data.map(function(e){return e.name})),d=d3.axisLeft(p);f.append("g").attr("transform","translate(0,0)").call(d).selectAll(".domain, .tick > line").remove();var v=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),m=function(e){d3.select(this).style("opacity",1),v.html("<b>"+e.name+":</b> "+e.value).style("left",+t.margin[3]+c(e.value)+"px").style("top",-o+t.margin[2]+p(e.name)+p.bandwidth()+"px").style("opacity",.9)},g=function(e){d3.select(this).style("opacity",.8),v.style("opacity",0)};f.selectAll(".bar").data(t.data).enter().append("rect").attr("class","bar").attr("fill",function(e){return e.fill}).style("opacity",.8).attr("x",function(e){return c(0)}).attr("width",function(e){return c(e.value)}).attr("y",function(e){return p(e.name)}).attr("height",p.bandwidth()).on("mouseover",m).on("mouseout",g)},makealive.lib.scatterplot01=function(e,t){var n=makealive.checkArguments(t,["title","xlab","ylab","data"]);if(n!="")throw"missing arguments: "+n;var r={size:[200,200],margin:[30,30,50,50],offset:["-1em","2.5em","-2.5em"],radius:3,color:"#0000cc",padding:.1};makealive.fillArguments(t,r),t.r=+t.r,t.padding=+t.padding;for(var i=0;i<4;i++)t.margin[i]=+t.margin[i];var s=+t.size[0],o=+t.size[1],u=o-t.margin[0]-t.margin[2],a=s-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+s+"px; height: "+o+"px");var f=d3.select(e).append("svg").attr("width",s+"px").attr("height",o+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")"),l=function(e){var n=+e[1]-e[0];return e[0]=e[0]-n*t.padding,e[1]=e[1]+n*t.padding,e},c=t.data.map(function(e){return+e.x}),h=l([Math.min.apply(null,c),Math.max.apply(null,c)]),p=t.data.map(function(e){return+e.y}),d=l([Math.min.apply(null,p),Math.max.apply(null,p)]),v=t.data.map(function(e){return+e.z}),m=Math.max.apply(null,v),g=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),y=function(e){d3.select(this).style("opacity",1),g.html("<b>"+e.name+":</b> ("+e.x+", "+e.y+")").style("left",+t.margin[3]+S(e.x)+"px").style("top",-o+w(e.y)+"px").style("opacity",.9),g.style("display")=="none"&&g.style("display","inline-block")},b=function(e){d3.select(this).style("opacity",.8),g.style("opacity",0).style("display","none")},w=d3.scaleLinear().range([u,0]).domain(d),E=d3.axisLeft(w).ticks(4);f.append("g").call(E),f.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(o-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").text(t.ylab);var S=d3.scaleLinear().range([0,a]).domain(h),x=d3.axisBottom(S).ticks(4);f.append("g").attr("transform","translate(0,"+u+")").call(x),f.append("text").attr("y",0+u).attr("x",0+a/2).attr("dy",t.offset[1]).style("text-anchor","middle").text(t.xlab),f.selectAll(".bar").data(t.data).enter().append("circle").attr("class","scatterdot").attr("fill",t.color).style("opacity",function(e){return.8}).attr("cx",function(e){return S(e.x)}).attr("cy",function(e){return w(e.y)}).attr("r",function(e){return t.radius}).on("mouseover",y).on("mouseout",b),f.append("text").text(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0)},makealive.lib.venn01=function(e,t){var n=makealive.checkArguments(t,["A","B"]);if(n!="")throw"missing arguments: "+n;var r={size:[180,120],margin:[10,10,10,10],names:["A","B"],opacity:.5,color:["#dd2222","#2222dd"]};makealive.fillArguments(t,r);for(var i=0;i<4;i++)t.margin[i]=+t.margin[i];t.opacity=parseFloat(t.opacity),t.A=[].concat(t.A),t.B=[].concat(t.B);var s=function(e){e.sort();var t=[];for(var n=0;n<e.length;n++)(n==0||e[n]!=e[n-1])&&t.push(e[n]);return t},o=function(e,t){e=Math.abs(e);var n=Math.acos(e/t),r=t*t*n,i=e*Math.sqrt(t*t-e*e);return r-i},u=function(e,t,n){if(e==0)return[0,0];if(e>=t+n){var r=Math.sqrt(t*n)/4;return[-t-r,n+r]}return y=(e*e+t*t-n*n)/(2*e),[-y,e-y,Math.abs(Math.acos(Math.abs(y)/t)),Math.abs(Math.acos(Math.abs(e-y)/n))]},a=function(e,t,n){var r=t<n?t:n,i=t>=n?t:n;if(e+r<=i)return r*r*Math.PI;if(e>=t+n)return 0;var s=u(e,t,n);if(Math.sign(s[0])*Math.sign(s[1])<0)return o(s[0],t)+o(s[1],n);var a=t<n?0:1,f=(a+1)%2;return o(s[a],r)-o(s[f],i)+r*r*Math.PI},f=function(e){var t="",n="";for(var r=0;r<e.length;r++)n+=e[r]+" ",n.length>40&&(t+=n+"<br/>",n="");return t+n};t.A=t.A.map(function(e){return sanitizeHtml(e)}),t.B=t.B.map(function(e){return sanitizeHtml(e)}),t.A=s(t.A),t.B=s(t.B),t.AB=t.A.filter(function(e){return t.B.indexOf(e)!=-1});var l=Math.sqrt(t.A.length),c=Math.sqrt(t.B.length),h=t.AB.length*Math.PI;t.Aonly=t.A.filter(function(e){return t.B.indexOf(e)==-1}),t.Bonly=t.B.filter(function(e){return t.A.indexOf(e)==-1});var p=[f(t.Aonly),f(t.Bonly),f(t.AB)],d=u(l+c+2,l,c);if(h>0){var v=[Math.abs(l-c),l+c],m=[1,1],g=0;while(m[0]+m[1]>1e-5&&g<200){var y=[a(v[0],l,c),a(v[1],l,c)];m[0]=Math.abs((y[0]-h)/h),m[1]=Math.abs((y[1]-h)/h),m[1]<m[0]?v[0]=v[0]+(v[1]-v[0])/10:v[1]=v[1]-(v[1]-v[0])/10,g++}d=u(v[0],l,c)}var b=+t.size[0],w=+t.size[1],E=w-t.margin[0]-t.margin[2],S=b-t.margin[1]-t.margin[3],x=d[1]+c-(d[0]-l),T=l>c?2*l:2*c,N=[S/x,E/T];N=N[0]>N[1]?N[1]:N[0],d3.select(e).attr("style","width: "+b+"px; height: "+w+"px");var C=d3.select(e).append("svg").attr("width",b+"px").attr("height",w+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")"),k=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),L=function(e,t){var n=[e.cx-t[0],e.cy-t[1]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return r<e.r},A=function(e){var n=d3.mouse(this),r=[L(M[0],n),L(M[1],n)],i="",s=(t.opacity+1)/2;C.selectAll('circle[notmask="1"]').style("opacity",t.opacity),r[0]&&r[1]?(i="<b>"+M[0].name+" and "+M[1].name+"<b><br/>"+p[2],C.select('[val="AB"]').style("opacity",s)):r[0]&&!r[1]?(i="<b>"+M[0].name+" not "+M[1].name+"</b><br/>"+p[0],C.select('[val="Aonly"]').style("opacity",s)):r[1]&&!r[0]&&(i="<b>"+M[1].name+" not "+M[0].name+"</b><br/>"+p[1],C.select('[val="Bonly"]').style("opacity",s)),k.html(i).style("left",n[0]+"px").style("top",-E-t.margin[2]+n[1]+"px").style("opacity",.9)},O=function(e){C.selectAll('circle[notmask="1"]').style("opacity",t.opacity),k.style("opacity",0)},M=[{name:sanitizeHtml(t.names[0]),color:t.color[0],r:l*N,cx:l*N,cy:E/2},{name:sanitizeHtml(t.names[1]),color:t.color[1],r:c*N,cx:(l+d[1]-d[0])*N,cy:E/2}],_=C.append("defs"),D="mask"+Math.round(Math.random()*1e9),P=_.append("mask").attr("id",D+"A");P.append("rect").attr("y",-t.margin[0]).attr("x",-t.margin[3]).attr("width","200%").attr("height","200%").attr("fill","white"),P.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("fill","black");var H=_.append("mask").attr("id",D+"B");H.append("rect").attr("width","100%").attr("height","100%").attr("fill","white"),H.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("fill","black");var B=_.append("mask").attr("id",D+"AB");B.append("rect").attr("width","100%").attr("height","100%").attr("fill","black"),B.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("fill","white"),C.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("mask","url(#"+D+"A)").attr("val","Aonly").style("opacity",t.opacity).attr("fill",M[0].color).attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"B)").attr("val","Bonly").style("opacity",t.opacity).attr("fill",M[1].color).attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"AB)").style("opacity",t.opacity).attr("fill",M[1].color).attr("val","AB").attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"AB)").style("opacity",t.opacity).attr("fill",M[0].color).attr("val","AB").attr("notmask","1"),C.on("mousemove",A).on("mouseout",O)},makealive.lib.barplot01=function(e,t){var n=makealive.checkArguments(t,["title","xlab","ylab","data"]);if(n!="")throw"missing arguments: "+n;var r={size:[200,200],margin:[40,20,40,50],offset:["-1.5em","2.5em","-2.5em"],padding:.2};makealive.fillArguments(t,r);for(var i=0;i<4;i++)t.margin[i]=+t.margin[i];var s=+t.size[0],o=+t.size[1],u=o-t.margin[0]-t.margin[2],a=s-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+s+"px; height: "+o+"px");var f=d3.select(e).append("svg").attr("width",s+"px").attr("height",o+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")");f.append("text").text(t.xlab).style("text-anchor","middle").attr("y",u).attr("dy",t.offset[1]).attr("x",a/2);var l=d3.scaleBand().range([0,a]).padding(t.padding).domain(t.data.map(function(e){return e.name})),c=d3.axisBottom(l);f.append("g").attr("transform","translate(0,"+u+")").call(c).selectAll(".domain, .tick > line").remove();var h=t.data.map(function(e){return e.value}),p=d3.scaleLinear().range([u,0]).domain([0,Math.max.apply(null,h)]),d=d3.axisLeft(p).ticks(4);f.append("g").call(d),f.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(o-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").text(t.ylab);var v=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),m=function(e){d3.select(this).style("opacity",1),v.html("<b>"+e.name+":</b> "+e.value).style("left",+t.margin[3]+l(e.name)+"px").style("top",-o+p(e.value)+"px").style("opacity",.9)},g=function(e){d3.select(this).style("opacity",.8),v.style("opacity",0)};f.selectAll(".bar").data(t.data).enter().append("rect").attr("class","bar").attr("fill",function(e){return e.fill}).style("opacity",.8).attr("x",function(e){return l(e.name)}).attr("width",l.bandwidth()).attr("y",function(e){return p(e.value)}).attr("height",function(e){return u-p(e.value)}).on("mouseover",m).on("mouseout",g),f.append("text").text(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0)},makealive.lib.isprime=function(e,t){var n=makealive.checkArguments(t,["number"]);if(n!="")throw"missing arguments: "+n;t.number=Math.abs(parseInt(t.number));var r=0;for(var i=2;i<t.number;i++)if(t.number%i==0){r=i;break}var s='<b style="font-size:130%">',o='<div style="font-size: 130%; padding: 10px; text-align: center">'+s+t.number+"</b> is";r==0?o+=" a prime number.":o+=" not prime. It is divisible by "+s+r+"</b>.",o+="</div>",e.innerHTML=o};