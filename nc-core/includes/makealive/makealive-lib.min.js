/** 
 * makealive.js
 * 
 * Make html alive with javascript
 * 
 * Author: Tomasz Konopka
 * 
 */var makealive={};makealive.lib={},makealive.types=[],document.addEventListener("DOMContentLoaded",function(){makealive.types=[];for(var e in makealive.lib)makealive.lib.hasOwnProperty(e)&&typeof makealive["lib"][e]=="function"&&makealive.types.push(e)}),makealive.clearTypes=function(){makealive.types=[]},makealive.addType=function(e,t){this.types.indexOf(e)<0&&this.types.push(e),this.lib[e]=t},makealive.setTypes=function(e){this.clearTypes();for(var t in e)e.hasOwnProperty(t)&&this.addType(t,e[t])},makealive.convert=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("pre code.makealive");for(var r=0;r<n.length;r++){var i=n[r],s=i.parentNode,o=null;for(var u=0;u<makealive.types.length;u++){var a=makealive.types[u];i.classList.contains(a)&&(o=a)}o!=null&&typeof this["lib"][o]!="function"&&(s.innerHTML+="\nmakealive error: undeclared function "+o,o=null);if(o!=null)try{var f=JSON.parse(i.innerHTML)}catch(l){s.innerHTML+="\nmakealive error: cannot parse JSON",o=null}if(o!=null){var c=document.createElement("div");c.className+="makealive";try{this.lib[o](c,f),s.parentNode.replaceChild(c,s)}catch(l){s.innerHTML+="\nmakealive error during conversion: "+l}}}return t},makealive.checkArgs=function(e,t){var n="";for(var r=0;r<t.length;r++)if(t[r].value===null){var i=t[r].name;i in e||(n+=" "+i)}if(n!="")throw"missing arguments: "+n;return makealive.fillArgs(e,t)},makealive.fillArgs=function(e,t){for(var n=0;n<t.length;n++){var r=t[n].name;e.hasOwnProperty(r)||(e[r]=t[n].value);var i=t[n].type.split(":")[0];if(i=="integer")for(var s=0;s<e[r].length;s++)e[r][s]=+parseInt(e[r][s]);else if(i=="number")for(var s=0;s<e[r].length;s++)e[r][s]=0+parseFloat(e[r][s])}return e},makealive.defArg=function(e,t,n,r){var i={};return i.name=e,i.type=t,i.description=n,i.value=r,i},makealive.lib.barplot02=function(e,t){var n=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:value:fill","contents of bar plot",null),makealive.defArg("size","integer:2","size (width, height)",[360,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[70,20,30,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-3.3em","-2.0em","-2.0em"]),makealive.defArg("padding","number","space between bars",.2)];if(e===null)return n;makealive.checkArgs(t,n);var r=+t.size[0],i=+t.size[1],s=i-t.margin[0]-t.margin[2],o=r-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+r+"px; height: "+i+"px");var u=d3.select(e).append("svg").attr("width",r+"px").attr("height",i+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")");u.append("text").html(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0);var a=t.data.map(function(e){return e.value});u.append("text").html(t.xlab).style("text-anchor","left").attr("y",0).attr("dy",t.offset[1]).attr("x",0);var f=d3.scaleLinear().range([0,o]).domain([0,Math.max.apply(null,a)]),l=d3.axisTop(f).ticks(5);u.append("g").attr("transform","translate(0,0)").call(l),u.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(i-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").html(t.ylab);var c=d3.scaleBand().range([0,s]).padding(t.padding).domain(t.data.map(function(e){return e.name})),h=d3.axisLeft(c);u.append("g").attr("transform","translate(0,0)").call(h).selectAll(".domain, .tick > line").remove();var p=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),d=function(e){d3.select(this).style("opacity",1),p.html("<b>"+e.name+":</b> "+e.value).style("left",+t.margin[3]+f(e.value)+"px").style("top",-i+t.margin[2]+c(e.name)+c.bandwidth()+"px").style("opacity",.9)},v=function(e){d3.select(this).style("opacity",.8),p.style("opacity",0)};u.selectAll(".bar").data(t.data).enter().append("rect").attr("class","bar").attr("fill",function(e){return e.fill}).style("opacity",.8).attr("x",function(e){return f(0)}).attr("width",function(e){return f(e.value)}).attr("y",function(e){return c(e.name)}).attr("height",c.bandwidth()).on("mouseover",d).on("mouseout",v)},makealive.lib.scatterplot01=function(e,t){var n=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:x:y:name","contents of scatter plot",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[30,30,50,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1em","2.5em","-2.5em"]),makealive.defArg("radius","number","point size",3),makealive.defArg("color","color","point color","#0000cc"),makealive.defArg("padding","number","space around points",.1)];if(e===null)return n;makealive.checkArgs(t,n);var r=+t.size[0],i=+t.size[1],s=i-t.margin[0]-t.margin[2],o=r-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+r+"px; height: "+i+"px");var u=d3.select(e).append("svg").attr("width",r+"px").attr("height",i+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")"),a=function(e){var n=+e[1]-e[0];return e[0]=e[0]-n*t.padding,e[1]=e[1]+n*t.padding,e},f=t.data.map(function(e){return+e.x}),l=a([Math.min.apply(null,f),Math.max.apply(null,f)]),c=t.data.map(function(e){return+e.y}),h=a([Math.min.apply(null,c),Math.max.apply(null,c)]),p=t.data.map(function(e){return+e.z}),d=Math.max.apply(null,p),v=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),m=function(e){d3.select(this).style("opacity",1),v.html("<b>"+e.name+":</b> ("+e.x+", "+e.y+")").style("left",+t.margin[3]+w(e.x)+"px").style("top",-i+y(e.y)+"px").style("opacity",.9),v.style("display")=="none"&&v.style("display","inline-block")},g=function(e){d3.select(this).style("opacity",.8),v.style("opacity",0).style("display","none")},y=d3.scaleLinear().range([s,0]).domain(h),b=d3.axisLeft(y).ticks(4);u.append("g").call(b),u.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(i-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").text(t.ylab);var w=d3.scaleLinear().range([0,o]).domain(l),E=d3.axisBottom(w).ticks(4);u.append("g").attr("transform","translate(0,"+s+")").call(E),u.append("text").attr("y",0+s).attr("x",0+o/2).attr("dy",t.offset[1]).style("text-anchor","middle").text(t.xlab),u.selectAll(".bar").data(t.data).enter().append("circle").attr("class","scatterdot").attr("fill",t.color).style("opacity",function(e){return.8}).attr("cx",function(e){return w(e.x)}).attr("cy",function(e){return y(e.y)}).attr("r",function(e){return t.radius}).on("mouseover",m).on("mouseout",g),u.append("text").text(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0)},makealive.lib.venn02=function(e,t){var n=makealive.lib.venn01(null,t);n=n.filter(function(e){return e.name!="B"});if(e===null)return n;t.B=[],makealive.checkArgs(t,n),t.names[1]="[custom set]",t.A=[].concat(t.A);var r=document.createElement("div"),i=document.createElement("div"),s='<label>Custom set</label><br/><textarea rows="'+t.rows+'" style="line-height:1.1"></textarea>';i.innerHTML=s,e.appendChild(r),e.appendChild(i);var o=i.getElementsByTagName("textarea")[0];o.addEventListener("input",function(){var e=o.value.split(/\n/);t.B=e.filter(function(e){return e!=""});while(r.hasChildNodes())r.removeChild(r.lastChild);makealive.lib.venn01(r,t),r.style["float"]="left"},!1),makealive.lib.venn01(r,t),r.style["float"]="left"},makealive.lib.venn01=function(e,t){var n=[makealive.defArg("A","array","set A",null),makealive.defArg("B","array","set B",null),makealive.defArg("size","integer:2","size (width, height)",[180,120]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[20,15,10,15]),makealive.defArg("title","string","chart title",""),makealive.defArg("offset","length","offset of title from sets","-0.5em"),makealive.defArg("names","string:2","set names",["A","B"]),makealive.defArg("opacity","number","opacity",.5),makealive.defArg("color","color:2","set colors",["#dd0000","#dd9900"])];if(e===null)return n;makealive.checkArgs(t,n),t.A=[].concat(t.A),t.B=[].concat(t.B);var r=function(e){e.sort();var t=[];for(var n=0;n<e.length;n++)(n==0||e[n]!=e[n-1])&&t.push(e[n]);return t},i=function(e,t){e=Math.abs(e);var n=Math.acos(e/t),r=t*t*n,i=e*Math.sqrt(t*t-e*e);return r-i},s=function(e,t,n){if(e==0)return[0,0];if(e>=t+n){var r=Math.sqrt(t*n)/4;return[-t-r,n+r]}return y=(e*e+t*t-n*n)/(2*e),[-y,e-y,Math.abs(Math.acos(Math.abs(y)/t)),Math.abs(Math.acos(Math.abs(e-y)/n))]},o=function(e,t,n){var r=t<n?t:n,o=t>=n?t:n;if(e+r<=o)return r*r*Math.PI;if(e>=t+n)return 0;var u=s(e,t,n);if(Math.sign(u[0])*Math.sign(u[1])<0)return i(u[0],t)+i(u[1],n);var a=t<n?0:1,f=(a+1)%2;return i(u[a],r)-i(u[f],o)+r*r*Math.PI};t.A=t.A.map(function(e){return sanitizeHtml(e)}),t.B=t.B.map(function(e){return sanitizeHtml(e)}),t.A=r(t.A),t.B=r(t.B),t.AB=t.A.filter(function(e){return t.B.indexOf(e)!=-1});var u=Math.sqrt(t.A.length),a=Math.sqrt(t.B.length),f=t.AB.length*Math.PI;t.Aonly=t.A.filter(function(e){return t.B.indexOf(e)==-1}),t.Bonly=t.B.filter(function(e){return t.A.indexOf(e)==-1});var l=[t.Aonly.length,t.Bonly.length,t.AB.length],c=[t.Aonly.join(", "),t.Bonly.join(", "),t.AB.join(", ")];for(var h=0;h<3;h++){var p=l[h]==1?"":"s";c[h]="("+l[h]+" item"+p+")<br/>"+c[h]}var d=s(u+a+2,u,a);if(f>0){var v=[Math.abs(u-a),u+a],m=[1,1],g=0;while(m[0]+m[1]>1e-5&&g<200){var y=[o(v[0],u,a),o(v[1],u,a)];m[0]=Math.abs((y[0]-f)/f),m[1]=Math.abs((y[1]-f)/f),m[1]<m[0]?v[0]=v[0]+(v[1]-v[0])/10:v[1]=v[1]-(v[1]-v[0])/10,g++}d=s(v[0],u,a)}var b=+t.size[0],w=+t.size[1],E=w-t.margin[0]-t.margin[2],S=b-t.margin[1]-t.margin[3],x=d[1]+a-(d[0]-u),T=u>a?2*u:2*a,N=[S/x,E/T];N=N[0]>N[1]?N[1]:N[0],d3.select(e).attr("style","width: "+b+"px; height: "+w+"px");var C=d3.select(e).append("svg").attr("width",b+"px").attr("height",w+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")"),k=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("line-height",1.2).style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),L=function(e,t){var n=[e.cx-t[0],e.cy-t[1]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return r<e.r},A=function(e){var n=d3.mouse(this),r=[L(M[0],n),L(M[1],n)],i="",s=(t.opacity+1)/2;C.selectAll('circle[notmask="1"]').style("opacity",t.opacity),r[0]&&r[1]?(i="<b>"+M[0].name+" AND "+M[1].name+"</b><br/>"+c[2],C.select('[val="AB"]').style("opacity",s)):r[0]&&!r[1]?(i="<b>"+M[0].name+" NOT "+M[1].name+"</b><br/>"+c[0],C.select('[val="Aonly"]').style("opacity",s)):r[1]&&!r[0]&&(i="<b>"+M[1].name+" NOT "+M[0].name+"</b><br/>"+c[1],C.select('[val="Bonly"]').style("opacity",s)),k.html(i).style("left",n[0]+"px").style("top",-E-t.margin[2]+n[1]+"px").style("opacity",.9)},O=function(e){C.selectAll('circle[notmask="1"]').style("opacity",t.opacity),k.style("opacity",0)},M=[{name:sanitizeHtml(t.names[0]),color:t.color[0],r:u*N,cx:u*N,cy:E/2},{name:sanitizeHtml(t.names[1]),color:t.color[1],r:a*N,cx:(u+d[1]-d[0])*N,cy:E/2}];if(u==0||a==0)M[1].cx=M[0].cx=(u+a)*N;var _=C.append("defs"),D="mask"+Math.round(Math.random()*1e9),P=_.append("mask").attr("id",D+"A");P.append("rect").attr("y",-t.margin[0]).attr("x",-t.margin[3]).attr("width","200%").attr("height","200%").attr("fill","white"),P.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("fill","black");var H=_.append("mask").attr("id",D+"B");H.append("rect").attr("width","100%").attr("height","100%").attr("fill","white"),H.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("fill","black");var B=_.append("mask").attr("id",D+"AB");B.append("rect").attr("width","100%").attr("height","100%").attr("fill","black"),B.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("fill","white"),C.append("circle").attr("cx",M[0].cx).attr("cy",M[0].cy).attr("r",M[0].r).attr("mask","url(#"+D+"A)").attr("val","Aonly").style("opacity",t.opacity).attr("fill",M[0].color).attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"B)").attr("val","Bonly").style("opacity",t.opacity).attr("fill",M[1].color).attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"AB)").style("opacity",t.opacity).attr("fill",M[1].color).attr("val","AB").attr("notmask","1"),C.append("circle").attr("cx",M[1].cx).attr("cy",M[1].cy).attr("r",M[1].r).attr("mask","url(#"+D+"AB)").style("opacity",t.opacity).attr("fill",M[0].color).attr("val","AB").attr("notmask","1"),C.on("mousemove",A).on("mouseout",O),t.title==""&&(t.title=t.names[0]+" vs. "+t.names[1]),C.append("text").html(t.title).style("text-anchor","middle").attr("y",0).attr("dy",t.offset).attr("x",(M[0].cx+M[1].cx)/2)},makealive.lib.barplot01=function(e,t){var n=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:value:fill","contents of bar plot",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[40,20,40,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1.5em","2.5em","-2.5em"]),makealive.defArg("padding","number","space between bars",.2)];if(e===null)return n;makealive.checkArgs(t,n);var r=+t.size[0],i=+t.size[1],s=i-t.margin[0]-t.margin[2],o=r-t.margin[1]-t.margin[3];d3.select(e).attr("style","width: "+r+"px; height: "+i+"px");var u=d3.select(e).append("svg").attr("width",r+"px").attr("height",i+"px").append("g").attr("transform","translate("+t.margin[3]+","+t.margin[0]+")");u.append("text").text(t.xlab).style("text-anchor","middle").attr("y",s).attr("dy",t.offset[1]).attr("x",o/2);var a=d3.scaleBand().range([0,o]).padding(t.padding).domain(t.data.map(function(e){return e.name})),f=d3.axisBottom(a);u.append("g").attr("transform","translate(0,"+s+")").call(f).selectAll(".domain, .tick > line").remove();var l=t.data.map(function(e){return e.value}),c=d3.scaleLinear().range([s,0]).domain([0,Math.max.apply(null,l)]),h=d3.axisLeft(c).ticks(4);u.append("g").call(h),u.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-(i-t.margin[0]-t.margin[2])/2).attr("dy",t.offset[2]).style("text-anchor","middle").text(t.ylab);var p=d3.select(e).append("div").style("opacity",0).style("background-color","#333333").style("border-radius","4px").style("position","relative").style("color","#fff4f4").style("padding","4px 8px").style("font-size","80%").style("display","inline-block").style("text-align","center"),d=function(e){d3.select(this).style("opacity",1),p.html("<b>"+e.name+":</b> "+e.value).style("left",+t.margin[3]+a(e.name)+"px").style("top",-i+c(e.value)+"px").style("opacity",.9)},v=function(e){d3.select(this).style("opacity",.8),p.style("opacity",0)};u.selectAll(".bar").data(t.data).enter().append("rect").attr("class","bar").attr("fill",function(e){return e.fill}).style("opacity",.8).attr("x",function(e){return a(e.name)}).attr("width",a.bandwidth()).attr("y",function(e){return c(e.value)}).attr("height",function(e){return s-c(e.value)}).on("mouseover",d).on("mouseout",v),u.append("text").text(t.title).style("text-anchor","left").attr("y",0).attr("dy",t.offset[0]).attr("x",0)},makealive.lib.isprime=function(e,t){var n=[makealive.defArg("number","integer","query number",null)];if(e===null)return n;makealive.checkArgs(t,n),t.number=Math.abs(parseInt(t.number));var r=0;for(var i=2;i<t.number;i++)if(t.number%i==0){r=i;break}var s='<b style="font-size:130%">',o='<div style="font-size: 130%; padding: 10px; text-align: center">'+s+t.number+"</b> is";r==0?o+=" a prime number.":o+=" not prime. It is divisible by "+s+r+"</b>.",o+="</div>",e.innerHTML=o},makealive.lib.plotly=function(e,t){var n=[makealive.defArg("data","array","data input for Plotly.newPlot",null),makealive.defArg("layout","array","layout settings for Plotly.newPlot",null)];if(e===null)return n;var r="plotly-"+Math.floor(Math.random()*1e9);e.setAttribute("id",r);var i=0,s=function(){var e=document.getElementById(r);if(typeof e!="undefined"&&e!=null){Plotly.newPlot(r,t.data,t.layout);return}i++;if(!(i<20))throw"Error during plotly conversion: timeout";setTimeout(s,100)};s()};