/* makealive.js. Copyright 2017 Tomasz Konopka. */
var makealive={};makealive.lib={};makealive.types=[];document.addEventListener("DOMContentLoaded",function(){makealive.types=[];for(var name in makealive.lib){if(makealive.lib.hasOwnProperty(name)){if(typeof makealive["lib"][name]==="function"){makealive.types.push(name)}}}});makealive.clearTypes=function(){makealive.types=[]};makealive.addType=function(name,fn){if(this.types.indexOf(name)<0){this.types.push(name)}this["lib"][name]=fn};makealive.setTypes=function(typelist){this.clearTypes();for(var key in typelist){if(typelist.hasOwnProperty(key)){this.addType(key,typelist[key])}}};makealive.url=null;makealive.convert=function(x){var newdiv=document.createElement("div");newdiv.innerHTML=x;var allcodes=newdiv.querySelectorAll("pre code.makealive");for(var i=0;i<allcodes.length;i++){var nowcode=allcodes[i];var nowpre=nowcode.parentNode;var fn=null;for(var cc=0;cc<makealive.types.length;cc++){var nowtype=makealive.types[cc];if(nowcode.classList.contains(nowtype)){fn=nowtype}}if(fn!=null){if(typeof this["lib"][fn]!=="function"){nowpre.innerHTML+="\nmakealive error: undeclared function "+fn;fn=null}}if(fn!=null){try{var data=JSON.parse(nowcode.innerHTML)}catch(e){nowpre.innerHTML+="\nmakealive error: cannot parse JSON";fn=null}}if(fn!=null){var newobj=document.createElement("div");newobj.className+="makealive";try{this["lib"][fn](newobj,data);nowpre.parentNode.replaceChild(newobj,nowpre)}catch(e){nowpre.innerHTML+="\nmakealive error during conversion: "+e}}}return newdiv};makealive.checkArgs=function(x,expected){var result="";for(var i=0;i<expected.length;i++){if(expected[i].value===null){var einame=expected[i].name;if(!(einame in x))result+=" "+einame}}if(result!=""){throw"missing arguments: "+result}return makealive.fillArgs(x,expected)};makealive.fillArgs=function(x,expected){for(var i=0;i<expected.length;i++){var ikey=expected[i].name;if(!x.hasOwnProperty(ikey)){x[ikey]=expected[i]["value"]}var itype=expected[i]["type"].split(":")[0];if(itype=="integer"){for(var j=0;j<x[ikey].length;j++){x[ikey][j]=+parseInt(x[ikey][j])}}else if(itype=="number"){for(var j=0;j<x[ikey].length;j++){x[ikey][j]=0+parseFloat(x[ikey][j])}}}return x};makealive.defArg=function(name,type,description,value){var result={};result["name"]=name;result["type"]=type;result["description"]=description;result["value"]=value;return result};makealive.lib.stackedbarplot02=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:series:value","contents of bar plot",null),makealive.defArg("series","array:series:label:fill","series labels",null),makealive.defArg("size","integer:2","size (width, height)",[360,180]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[70,140,30,55]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-3.3em","-2.0em","-2.5em"]),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("legend","integer:3","legend position (x, y, spacing)",[200,20,16]),makealive.defArg("legendmarker","integer:2","legend marker (width, height, offset)",[15,8,-2]),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["top line","left"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="stackedbarplot01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var barnames=libtools.uniq(libtools.pluck(x.data,"name"));var yscale=d3.scaleBand().range([0,x.hinner]).padding(x.padding).domain(barnames);var yaxis=d3.axisLeft(yscale);libtools.d3yaxis(svg,x,yaxis);var seriesinfo=libtools.indexBy(x.series,"series");for(var i=0;i<x.series.length;i++){x.series[i]["id"]=i}var namedata=[];for(var i=0;i<barnames.length;i++){var idata=x.data.filter(function(d){return d.name==barnames[i]});idata.sort(function(a,b){return a.series>b.series});var itemp=0;for(var j=0;j<idata.length;j++){idata[j].lower=itemp;itemp+=idata[j].value;idata[j].upper=itemp}namedata[i]=idata}x.data=[];for(var i=0;i<namedata.length;i++){x.data=x.data.concat(namedata[i])}var barmax=libtools.max(libtools.pluck(x.data,"upper"));var xscale=d3.scaleLinear().range([0,x.winner]).domain([0,barmax]);var xaxis=d3.axisTop(xscale).ticks(5);libtools.d3xaxis(svg,x,xaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));var dlab=seriesinfo[d.series].label;tooltip.html("<b>"+d.name+": "+dlab+": </b> "+d.value).style("left",+x.margin[3]+xscale(d.upper)+"px").style("top",-x.h+x.margin[2]+yscale(d.name)+yscale.bandwidth()+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0)};svg.selectAll(".bar").data(x.data).enter().append("rect").attr("class","bar").attr("fill",function(d){return libtools.l2(seriesinfo[d.series].fill)}).attr("fillcolor",function(d){return seriesinfo[d.series].fill}).attr("x",function(d){return xscale(d.lower)}).attr("width",function(d){return xscale(d.upper)-xscale(d.lower)}).attr("y",function(d){return yscale(d.name)}).attr("height",yscale.bandwidth()).on("mouseover",tooltipshow).on("mouseout",tooltiphide);svg.selectAll(".legendtext").data(x.series).enter().append("text").html(function(d){return d.label}).attr("x",x.legend[0]+x.legendmarker[0]+x.legendmarker[2]).attr("y",function(d){var dpos=x.series.length-d.id-1;return x.legend[1]+dpos*x.legend[2]}).attr("val",function(d){return d.series}).style("text-anchor","left").style("font-size","10").attr("dx","0.5em").attr("dy","0.25em").attr("class","makealive legend");svg.selectAll(".legendmarker").data(x.series).enter().append("rect").attr("x",x.legend[0]).attr("y",function(d){var dpos=x.series.length-d.id-1;return x.legend[1]+dpos*x.legend[2]-x.legendmarker[1]/2}).attr("width",x.legendmarker[0]).attr("height",x.legendmarker[1]).attr("val",function(d){return d.series}).attr("fill",function(d){return seriesinfo[d.series]["fill"]}).attr("class","makealive legend");svg.selectAll(".legend").attr("opacity",1)};makealive.lib.stripchart01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:series:value","contents of plot",null),makealive.defArg("series","array:series:label:fill","definition of series",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[40,20,40,54]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1.5em","2.5em","-2.5em"]),makealive.defArg("radius","number","point size",3),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["bottom","left line"]),makealive.defArg("axiscolor","string","color of grid lines","#000000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="stripchart01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var seriesinfo=libtools.indexBy(x.series,"series");var xscale=d3.scaleBand().range([0,x.winner]).padding(x.padding).domain(libtools.pluck(x.series,"label"));var xaxis=d3.axisBottom(xscale);libtools.d3xaxis(svg,x,xaxis);var yvals=libtools.pluck(x.data,"value");var ylim=libtools.extlim([libtools.min(yvals),libtools.max(yvals)],x.padding/3);var yscale=d3.scaleLinear().range([x.hinner,0]).domain(ylim);var yaxis=d3.axisLeft(yscale).ticks(4);libtools.d3yaxis(svg,x,yaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));var dlab=seriesinfo[d.series]["label"]+": "+d.name;tooltip.html("<b>"+dlab+":</b> "+d.value).style("left",+x.margin[3]+xscale(seriesinfo[d.series].label)+6+"px").style("top",-x.size[1]+yscale(libtools.max([0,d.value]))-4+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0).style("left","0px").style("top","0px")};svg.selectAll(".marker").data(x.data).enter().append("circle").attr("class","marker").attr("fill",function(d){if(d.fill){return libtools.l2(d.fill)}else{return libtools.l2(seriesinfo[d.series].fill)}}).attr("fillcolor",function(d){if(d.fill){return d.fill}else{return seriesinfo[d.series].fill}}).attr("cx",function(d){return xscale(seriesinfo[d.series].label)+xscale.bandwidth()*Math.random()}).attr("cy",function(d){return yscale(d.value)}).attr("r",function(d){return x.radius}).on("mouseover",tooltipshow).on("mouseout",tooltiphide)};makealive.lib.venn02=function(obj,x){var xargs=makealive.lib.venn01(null,x);xargs=xargs.filter(function(x){return x.name!=="B"});if(obj===null)return xargs;x.B=[];makealive.checkArgs(x,xargs);x.makealive="barplot02";x.names[1]="[custom set]";x.A=[].concat(x.A);var venndiv=document.createElement("div");var formdiv=document.createElement("div");var formhtml='<label>Custom set</label><br/><textarea rows="'+x.rows+'" style="line-height:1.1; height: '+(x.size[1]-20)+'px"></textarea>';formdiv.innerHTML=formhtml;obj.appendChild(venndiv);obj.appendChild(formdiv);var tarea=formdiv.getElementsByTagName("textarea")[0];tarea.addEventListener("input",function(){var newset=tarea.value.split(/\n/);x.B=newset.filter(function(v){return v!==""});while(venndiv.hasChildNodes()){venndiv.removeChild(venndiv.lastChild)}makealive.lib.venn01(venndiv,x);venndiv.style["float"]="left"},false);makealive.lib.venn01(venndiv,x);venndiv.style["float"]="left"};makealive.lib.plate96=function(obj,x){if(obj===null){var temp=makealive.lib.bioplate01(obj,x);for(var i=0;i<temp.length;i++){if(temp[i].name==="wells"){temp.splice(i,1)}}return temp}x.makealive="plate96";x.wells=96;return makealive.lib.bioplate01(obj,x)};makealive.lib.venn01=function(obj,x){var xargs=[makealive.defArg("A","array","set A",null),makealive.defArg("B","array","set B",null),makealive.defArg("size","integer:2","size (width, height)",[180,140]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[25,15,10,15]),makealive.defArg("title","string","chart title",""),makealive.defArg("offset","length","offset of title from sets","-0.5em"),makealive.defArg("names","string:2","set names",["A","B"]),makealive.defArg("opacity","number","opacity",.5),makealive.defArg("color","color:2","set colors",["#dd0000","#dd9900"])];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="venn01";x.A=[].concat(x.A);x.B=[].concat(x.B);var libtools=makealive.libtools;var getChordArea=function(d,r){d=Math.abs(d);var alpha=Math.acos(d/r);var aslice=r*r*alpha;var atriangle=d*Math.sqrt(r*r-d*d);return aslice-atriangle};var getCXs=function(d,r1,r2){if(d===0){return[0,0]}if(d>=r1+r2){var gap=Math.sqrt(r1*r2)/4;return[-r1-gap,r2+gap]}temp=(d*d+r1*r1-r2*r2)/(2*d);return[-temp,d-temp,Math.abs(Math.acos(Math.abs(temp)/r1)),Math.abs(Math.acos(Math.abs(d-temp)/r2))]};var commonArea=function(d,r1,r2){var rmin=r1<r2?r1:r2;var rmax=r1>=r2?r1:r2;if(d+rmin<=rmax)return rmin*rmin*Math.PI;if(d>=r1+r2)return 0;var cxs=getCXs(d,r1,r2);if(Math.sign(cxs[0])*Math.sign(cxs[1])<0){return getChordArea(cxs[0],r1)+getChordArea(cxs[1],r2)}else{var imin=r1<r2?0:1;var imax=(imin+1)%2;return getChordArea(cxs[imin],rmin)-getChordArea(cxs[imax],rmax)+rmin*rmin*Math.PI}};x.A=x.A.map(function(v){return sanitizeHtml(v)});x.B=x.B.map(function(v){return sanitizeHtml(v)});x.A=libtools.uniq(x.A);x.B=libtools.uniq(x.B);x.AB=x.A.filter(function(v){return x.B.indexOf(v)!==-1});var rootA=Math.sqrt(x.A.length),rootB=Math.sqrt(x.B.length),areaAB=x.AB.length*Math.PI;x.Aonly=x.A.filter(function(v){return x.B.indexOf(v)===-1});x.Bonly=x.B.filter(function(v){return x.A.indexOf(v)===-1});var partlengths=[x.Aonly.length,x.Bonly.length,x.AB.length];var longcaptions=[x.Aonly.join(", "),x.Bonly.join(", "),x.AB.join(", ")];for(var k=0;k<3;k++){var withs=partlengths[k]===1?"":"s";longcaptions[k]="("+partlengths[k]+" item"+withs+")<br/>"+longcaptions[k]}var cxs=getCXs(rootA+rootB+2,rootA,rootB);if(areaAB>0){var drange=[Math.abs(rootA-rootB),rootA+rootB];var err=[1,1];var cc=0;while(err[0]+err[1]>1e-5&&cc<200){var temp=[commonArea(drange[0],rootA,rootB),commonArea(drange[1],rootA,rootB)];err[0]=Math.abs((temp[0]-areaAB)/areaAB);err[1]=Math.abs((temp[1]-areaAB)/areaAB);if(err[1]<err[0]){drange[0]=drange[0]+(drange[1]-drange[0])/10}else{drange[1]=drange[1]-(drange[1]-drange[0])/10}cc++}cxs=getCXs(drange[0],rootA,rootB)}libtools.dims(x);var svg=libtools.d3svg(obj,x);var wdata=cxs[1]+rootB-(cxs[0]-rootA);var hdata=rootA>rootB?2*rootA:2*rootB;var scale=[x.winner/wdata,x.hinner/hdata];scale=scale[0]>scale[1]?scale[1]:scale[0];var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var inSet=function(set,mp){var temp=[set.cx-mp[0],set.cy-mp[1]];var dd=Math.sqrt(temp[0]*temp[0]+temp[1]*temp[1]);return dd<set.r};var tooltipshow=function(d){var mp=d3.mouse(this);var insets=[inSet(svgdata[0],mp),inSet(svgdata[1],mp)];var nowcaption="";var midop=(x.opacity+1)/2;svg.selectAll('circle[notmask="1"]').style("opacity",x.opacity);if(insets[0]&&insets[1]){nowcaption="<b>"+svgdata[0].name+" AND "+svgdata[1].name+"</b><br/>"+longcaptions[2];svg.select('[val="AB"]').style("opacity",midop)}else if(insets[0]&&!insets[1]){nowcaption="<b>"+svgdata[0].name+" NOT "+svgdata[1].name+"</b><br/>"+longcaptions[0];svg.select('[val="Aonly"]').style("opacity",midop)}else if(insets[1]&&!insets[0]){nowcaption="<b>"+svgdata[1].name+" NOT "+svgdata[0].name+"</b><br/>"+longcaptions[1];svg.select('[val="Bonly"]').style("opacity",midop)}tooltip.html(nowcaption).style("left",mp[0]+"px").style("top",-(+x.size[1]/2)-x.margin[0]+mp[1]+"px").style("opacity",.9)};var tooltiphide=function(){svg.selectAll('circle[notmask="1"]').style("opacity",x.opacity);tooltip.style("opacity",0)};var svgdata=[{name:sanitizeHtml(x.names[0]),color:x.color[0],r:rootA*scale,cx:rootA*scale,cy:x.hinner/2},{name:sanitizeHtml(x.names[1]),color:x.color[1],r:rootB*scale,cx:(rootA+cxs[1]-cxs[0])*scale,cy:x.hinner/2}];if(rootA===0||rootB===0){svgdata[1].cx=svgdata[0].cx=(rootA+rootB)*scale}var svgdefs=svg.append("defs");var nowrn="mask"+Math.round(Math.random()*1e9);var maskA=svgdefs.append("mask").attr("id",nowrn+"A");maskA.append("rect").attr("y",-x.margin[0]).attr("x",-x.margin[3]).attr("width","200%").attr("height","200%").attr("fill","white");maskA.append("circle").attr("cx",svgdata[1].cx).attr("cy",svgdata[1].cy).attr("r",svgdata[1].r).attr("fill","black");var maskB=svgdefs.append("mask").attr("id",nowrn+"B");maskB.append("rect").attr("width","100%").attr("height","100%").attr("fill","white");maskB.append("circle").attr("cx",svgdata[0].cx).attr("cy",svgdata[0].cy).attr("r",svgdata[0].r).attr("fill","black");var maskAB=svgdefs.append("mask").attr("id",nowrn+"AB");maskAB.append("rect").attr("width","100%").attr("height","100%").attr("fill","black");maskAB.append("circle").attr("cx",svgdata[0].cx).attr("cy",svgdata[0].cy).attr("r",svgdata[0].r).attr("fill","white");svg.append("circle").attr("cx",svgdata[0].cx).attr("cy",svgdata[0].cy).attr("r",svgdata[0].r).attr("mask","url(#"+nowrn+"A)").attr("val","Aonly").style("opacity",x.opacity).attr("fill",svgdata[0].color).attr("notmask","1");svg.append("circle").attr("cx",svgdata[1].cx).attr("cy",svgdata[1].cy).attr("r",svgdata[1].r).attr("mask","url(#"+nowrn+"B)").attr("val","Bonly").style("opacity",x.opacity).attr("fill",svgdata[1].color).attr("notmask","1");svg.append("circle").attr("cx",svgdata[1].cx).attr("cy",svgdata[1].cy).attr("r",svgdata[1].r).attr("mask","url(#"+nowrn+"AB)").style("opacity",x.opacity).attr("fill",svgdata[1].color).attr("val","AB").attr("notmask","1");svg.append("circle").attr("cx",svgdata[1].cx).attr("cy",svgdata[1].cy).attr("r",svgdata[1].r).attr("mask","url(#"+nowrn+"AB)").style("opacity",x.opacity).attr("fill",svgdata[0].color).attr("val","AB").attr("notmask","1");svg.on("mousemove",tooltipshow).on("mouseout",tooltiphide);if(x.title===""){x.title=x.names[0]+" vs. "+x.names[1]}svg.append("text").html(x.title).style("text-anchor","middle").attr("y",0).attr("dy",x.offset).attr("x",(svgdata[0].cx+svgdata[1].cx)/2)};makealive.lib.stripchart02=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:series:value","contents of plot",null),makealive.defArg("series","array:series:label:fill","definition of series",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[60,20,30,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-3.0em","-1.8em","-2.5em"]),makealive.defArg("radius","number","point size",3),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["top line","left"]),makealive.defArg("axiscolor","string","color of grid lines","#000000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="stripchart01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var seriesinfo=libtools.indexBy(x.series,"series");var yscale=d3.scaleBand().range([0,x.hinner]).padding(x.padding).domain(libtools.pluck(x.series,"label"));var yaxis=d3.axisLeft(yscale);libtools.d3yaxis(svg,x,yaxis);var xvals=libtools.pluck(x.data,"value");var xlim=libtools.extlim([libtools.min(xvals),libtools.max(xvals)],x.padding/3);var xscale=d3.scaleLinear().range([0,x.winner]).domain(xlim);var xaxis=d3.axisTop(xscale).ticks(4);libtools.d3xaxis(svg,x,xaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));var dlab=seriesinfo[d.series]["label"]+": "+d.name;tooltip.html("<b>"+dlab+":</b> "+d.value).style("left",+x.margin[3]+xscale(d.value)+6+"px").style("top",-x.h+x.margin[2]+yscale(seriesinfo[d.series].label)+6+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0).style("left","0px").style("top","0px")};svg.selectAll(".marker").data(x.data).enter().append("circle").attr("class","marker").attr("fill",function(d){if(d.fill){return libtools.l2(d.fill)}else{return libtools.l2(seriesinfo[d.series].fill)}}).attr("fillcolor",function(d){if(d.fill){return d.fill}else{return seriesinfo[d.series].fill}}).attr("cy",function(d){return yscale(seriesinfo[d.series].label)+yscale.bandwidth()*Math.random()}).attr("cx",function(d){return xscale(d.value)}).attr("r",function(d){return x.radius}).on("mouseover",tooltipshow).on("mouseout",tooltiphide)};makealive.lib.plate12=function(obj,x){if(obj===null){var temp=makealive.lib.bioplate01(obj,x);for(var i=0;i<temp.length;i++){if(temp[i].name==="wells"){temp.splice(i,1)}}return temp}x.makealive="plate12";x.wells=12;return makealive.lib.bioplate01(obj,x)};makealive.lib.bioplate01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("wells","ineger","number of wells",null),makealive.defArg("data","array:well:value:label","contents of bar plot",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[20,12,12,12]),makealive.defArg("offset","length:1","label offset from axis (top)",["-0.5em"]),makealive.defArg("padding","number","space between wells",.153),makealive.defArg("platecolor","color","color of plate lines","#000000"),makealive.defArg("wellcolor","color","colors of wells","#dd0000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);switch(x.wells){case 24:var hh=4,ww=6;break;case 48:var hh=6,ww=8;break;case 96:var hh=8,ww=12;break;case 384:var hh=12,ww=24;break;default:var hh=3,ww=4}var rr=x.winner/(2*ww+1.5+(ww-1)*x.padding);var pp=rr*x.padding;var dec2=libtools.dec2;x.winner-=.5;x.hinner=dec2((2*hh+1)*rr+(hh-1)*pp)+.5;svg.append("polygon").attr("fill","#ffffff").attr("stroke",x.platecolor).attr("points","-0.5,-0.5 "+x.winner+",-0.5 "+x.winner+","+x.hinner+" -0.5,"+x.hinner);var getWellColor=function(d){if(!(d.well in x.data)){return"#ffffff"}var well=x.data[d.well];if(!well.value){return"#ffffff"}if(libtools.isColor(well.value)){return well.value}return libtools.shadeColor(x.wellcolor,1-well.value)};var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thiswell=d3.select(this);thiswell.attr("fill",thiswell.attr("fillcolor"));if(!(d.well in x.data)){return}var well=x.data[d.well];tooltip.html("<b>"+d.well+": "+well.label+":</b> "+well.value).style("left",+x.margin[3]+ +thiswell.attr("cx")+rr*.8+"px").style("top",-x.size[1]+ +thiswell.attr("cy")+"px").style("opacity",.9)};var tooltiphide=function(d){var thiswell=d3.select(this);thiswell.attr("fill",libtools.l2(thiswell.attr("fillcolor")));tooltip.style("opacity",0)};var ab=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P"];var wellpositions=[];for(var i=1;i<=ww;i++){for(var j=1;j<=hh;j++){var onewell={well:ab[j]+""+i,cx:dec2(2*i*rr+(i-1)*pp),cy:dec2(.75*rr+(2*j-1)*rr+(j-1)*pp)};wellpositions.push(onewell)}}x.data=libtools.indexBy(x.data,"well");svg.selectAll(".well").data(wellpositions).enter().append("circle").attr("class","well").attr("fill",function(d){return libtools.l2(getWellColor(d))}).attr("fillcolor",getWellColor).attr("stroke",x.platecolor).attr("cx",function(d){return d.cx}).attr("cy",function(d){return d.cy}).attr("r",rr).on("mouseover",tooltipshow).on("mouseout",tooltiphide);var ylab=[];for(var j=1;j<=hh;j++){ylab.push({t:ab[j],j:j})}svg.selectAll(".ylab").data(ylab).enter().append("text").attr("font-size",10).attr("font-weight",600).attr("x",dec2(rr/2)).attr("y",function(d){return dec2(.75*rr+(2*d.j-1)*rr+(d.j-1)*pp)}).attr("dy","0.4em").attr("dx","-0.4em").html(function(d){return d.t});var xlab=[];for(var i=1;i<=ww;i++){xlab.push({t:i,i:i})}svg.selectAll(".xlab").data(xlab).enter().append("text").attr("font-size",10).attr("font-weight",400).attr("x",function(d){return dec2(2*d.i*rr+(d.i-1)*pp)}).attr("y",dec2(.75*rr/2)).attr("dy","0.3em").attr("text-anchor","middle").html(function(d){return d.t})};makealive.lib.isprime=function(obj,x){var xargs=[makealive.defArg("number","integer","query number",null)];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="isprime";x.number=Math.abs(parseInt(x.number));var xfactor=0;for(var i=2;i<x.number;i++){if(x.number%i===0){xfactor=i;break}}var blarge='<b style="font-size:130%">';var result='<div style="font-size: 130%; padding: 10px; text-align: center">'+blarge+x.number+"</b> is";if(xfactor===0){result+=" a prime number."}else{result+=" not prime. It is divisible by "+blarge+xfactor+"</b>."}result+="</div>";obj.innerHTML=result};makealive.lib.scatterplot01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:x:y:name","contents of scatter plot",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[30,30,50,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1em","2.5em","-2.5em"]),makealive.defArg("radius","number","point size",3),makealive.defArg("color","color","point color","#0000cc"),makealive.defArg("padding","number","space around points",.1),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["bottom line","left line"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="scatterplot01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);var xvalues=libtools.pluck(x.data,"x");var yvalues=libtools.pluck(x.data,"y");var xlim=libtools.extlim([libtools.min(xvalues),libtools.max(xvalues)],x.padding);var ylim=libtools.extlim([libtools.min(yvalues),libtools.max(yvalues)],x.padding);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){d3.select(this).style("opacity",1);tooltip.html("<b>"+d.name+":</b> ("+d.x+", "+d.y+")").style("left",+x.margin[3]+xscale(d.x)+6+"px").style("top",-x.h+yscale(d.y)+6+"px").style("opacity",.9)};var tooltiphide=function(d){d3.select(this).style("opacity",.8);tooltip.style("opacity",0).style("left","0px").style("top","0px")};var yscale=d3.scaleLinear().range([x.hinner,0]).domain(ylim);var yaxis=d3.axisLeft(yscale).ticks(4);libtools.d3yaxis(svg,x,yaxis);var xscale=d3.scaleLinear().range([0,x.winner]).domain(xlim);var xaxis=d3.axisBottom(xscale).ticks(4);libtools.d3xaxis(svg,x,xaxis);svg.selectAll(".marker").data(x.data).enter().append("circle").attr("class","marker").attr("fill",x.color).style("opacity",function(d){return.8}).attr("cx",function(d){return xscale(d.x)}).attr("cy",function(d){return yscale(d.y)}).attr("r",function(d){return x.radius}).on("mouseover",tooltipshow).on("mouseout",tooltiphide);libtools.d3title(svg,x)};if(typeof makealive.libtools==="undefined"){makealive.libtools={}}makealive.libtools.dims=function(x){x.w=+x.size[0];x.h=+x.size[1];x.hinner=x.h-x.margin[0]-x.margin[2];x.winner=x.w-x.margin[1]-x.margin[3]};makealive.libtools.dec2=function(x){return Math.round(x*100)/100};makealive.libtools.isColor=function(x){var six=/^#[0-9A-F]{6}$/i.test(x);var three=/^#[0-9A-F]{3}$/i.test(x);return six|three};makealive.libtools.d3svg=function(obj,x){d3.select(obj).attr("style","width: "+x.w+"px; height: "+x.h+"px");var svg=d3.select(obj).append("svg").attr("class","makealive "+x.makealive).attr("width",x.w+"px").attr("height",x.h+"px").append("g").attr("transform","translate("+x.margin[3]+","+x.margin[0]+")");return svg};makealive.libtools.d3ylab=function(svg,x){svg.append("text").text(x.ylab).attr("transform","rotate(-90)").attr("class","ylab").attr("x",0-(x.h-x.margin[0]-x.margin[2])/2).attr("y",0).attr("dy",x.offset[2])};makealive.libtools.d3xlab=function(svg,x,where){if(/bottom/.test(where)){svg.append("text").text(x.xlab).attr("class","xlab bottom").attr("x",x.winner/2).attr("y",x.hinner).attr("dy",x.offset[1])}else if(/top/.test(where)){svg.append("text").text(x.xlab).attr("class","xlab top").attr("x",0).attr("y",0).attr("dy",x.offset[1])}};makealive.libtools.d3title=function(svg,x){svg.append("text").text(x.title).attr("class","title").attr("x",0).attr("y",0).attr("dy",x.offset[0])};makealive.libtools.d3xaxis=function(svg,x,xaxis){var where=x.axisstyle[0];var yshift=0;if(/bottom/.test(where)){yshift=x.hinner}var gg=svg.append("g").attr("class","xaxis "+where).attr("transform","translate(0,"+yshift+")").call(xaxis);gg.selectAll("path.domain").attr("d","M"+x.winner+",0.5H-0.5");if(!/line/.test(where)&&!/grid/.test(where)){gg.selectAll(".domain, .tick > line").remove()}if(/grid/.test(where)){gg.selectAll(".domain").remove();gg.selectAll(".tick > line").each(function(){d3.select(this).attr("y1",0).attr("y2",x.hinner)})}gg.selectAll("line, path").each(function(){d3.select(this).attr("stroke",x.axiscolor)});makealive.libtools.d3xlab(svg,x,where)};makealive.libtools.d3yaxis=function(svg,x,yaxis){var where=x.axisstyle[1];var gg=svg.append("g").attr("class","yaxis "+where).call(yaxis);gg.selectAll("path.domain").attr("d","M0.5,"+x.hinner+"V0.5");if(!/line/.test(where)&!/grid/.test(where)){gg.selectAll(".domain, .tick > line").remove()}if(/grid/.test(where)){gg.selectAll(".domain").remove();gg.selectAll(".tick > line").each(function(){d3.select(this).attr("x1",0).attr("x2",x.winner)})}gg.selectAll("line, path").each(function(){d3.select(this).attr("stroke",x.axiscolor)});makealive.libtools.d3ylab(svg,x,where)};makealive.libtools.shadeColor=function(color,percent){var f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=f>>8&255,B=f&255;return"#"+(16777216+(Math.round((t-R)*p)+R)*65536+(Math.round((t-G)*p)+G)*256+(Math.round((t-B)*p)+B)).toString(16).slice(1)};makealive.libtools.l2=function(x){if(!x){x="#000000"}return makealive.libtools.shadeColor(x,.25)};makealive.libtools.extlim=function(d,pad){var drange=+d[1]-d[0];d[0]=d[0]-drange*pad;d[1]=d[1]+drange*pad;return d};makealive.libtools.pluck=function(d,key){return d.map(function(x){return x[key]})};makealive.libtools.max=function(a){var result=-Infinity;a.forEach(function(x){result=Math.max(result,x)});return result};makealive.libtools.min=function(a){var result=Infinity;a.forEach(function(x){result=Math.min(result,x)});return result};makealive.libtools.uniq=function(a){var result=[];var aset={};a.forEach(function(x){if(!aset.hasOwnProperty(x)){aset[x]=1;result.push(x)}});return result};makealive.libtools.indexBy=function(a,key){var result={};a.forEach(function(x){result[x[key]]=x});return result};makealive.lib.table01=function(obj,x){var xargs=[makealive.defArg("header","array","header",null),makealive.defArg("data","array","data",null),makealive.defArg("patterns","array","patterns array (string, color)",["","#ffffff"]),makealive.defArg("sortable","array","sortable columns",[])];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="table01";var regexes=[];var bgcols=[];for(var k=0;k<x.patterns.length;k++){regexes.push(new RegExp(x.patterns[k][0]));bgcols.push(sanitizeHtml(x.patterns[k][1]))}var regbg=function(s){var sbg="";for(var k=0;k<regexes.length;k++){if(regexes[k].test(s)){sbg=bgcols[k]}}if(sbg!==""){return' style="background-color: '+sbg+'"'}return sbg};var makeonerow=function(xdi,xcols){var onerow='<tr class="td">';for(var j=0;j<xcols.length;j++){var xtd=xcols[j]in xdi?sanitizeHtml(xdi[xcols[j]]):"";onerow+="<td"+regbg(xtd)+">"+xtd+"</td>"}return onerow+"</tr>"};var maketablebody=function(xd,xcols){var tbody="";for(var i=0;i<xd.length;i++){tbody+=makeonerow(x.data[i],xcols)}return tbody};var sortbycol=function(event){var esrc=event.target||event.srcElement;var sorttype=-1*parseInt(esrc.getAttribute("val"));esrc.setAttribute("val",sorttype);var sortcol=esrc.innerHTML;x.data.sort(function(a,b){if(sortcol in a&&sortcol in b){if(a[sortcol]>b[sortcol])return sorttype;if(a[sortcol]<b[sortcol])return-sorttype;return 0}else{return sortcol in a?-1:1}});var trtds=obj.querySelectorAll("tr.td");for(var i=0;i<trtds.length;i++){trtds[i].parentNode.removeChild(trtds[i])}var objtab=obj.getElementsByTagName("table");objtab[0].insertAdjacentHTML("beforeend",maketablebody(x.data,xcols))};var result='<table class="table">';result+="<tr>";var ncols=x.header.length;var xcols=[];for(var j=0;j<ncols;j++){xcols[j]=sanitizeHtml(x.header[j]);result+='<th val="-1">'+xcols[j]+"</th>"}result+="</tr>";result+=maketablebody(x.data,xcols)+"</table>";obj.innerHTML=result;var allth=obj.getElementsByTagName("th");for(var i=0;i<x.sortable.length;i++){var sci=x.header.indexOf(x.sortable[i]);if(sci>=0){allth[sci].addEventListener("click",sortbycol);allth[sci].style.cursor="pointer"}}};makealive.lib.barplot02=function(obj,x){
var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:value:fill","contents of bar plot",null),makealive.defArg("size","integer:2","size (width, height)",[360,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[70,20,30,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-3.3em","-2.0em","-2.0em"]),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["top line","left"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="barplot02";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var xvalues=libtools.pluck(x.data,"value");xvalues.push(0);var xscale=d3.scaleLinear().range([0,x.winner]).domain([libtools.min(xvalues),libtools.max(xvalues)]);var xaxis=d3.axisTop(xscale).ticks(5);libtools.d3xaxis(svg,x,xaxis);var yscale=d3.scaleBand().range([0,x.hinner]).padding(x.padding).domain(libtools.pluck(x.data,"name"));var yaxis=d3.axisLeft(yscale);libtools.d3yaxis(svg,x,yaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));tooltip.html("<b>"+d.name+":</b> "+d.value).style("left",+x.margin[3]+xscale(d.value)+"px").style("top",-x.h+x.margin[2]+yscale(d.name)+yscale.bandwidth()+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0)};svg.selectAll(".bar").data(x.data).enter().append("rect").attr("class","bar").attr("fill",function(d){return libtools.l2(d.fill)}).attr("fillcolor",function(d){return d.fill}).attr("x",function(d){return xscale(libtools.min([0,d.value]))}).attr("width",function(d){return xscale(libtools.max([0,d.value]))}).attr("y",function(d){return yscale(d.name)}).attr("height",yscale.bandwidth()).on("mouseover",tooltipshow).on("mouseout",tooltiphide)};makealive.lib.plate24=function(obj,x){if(obj===null){var temp=makealive.lib.bioplate01(obj,x);for(var i=0;i<temp.length;i++){if(temp[i].name==="wells"){temp.splice(i,1)}}return temp}x.makealive="plate24";x.wells=24;return makealive.lib.bioplate01(obj,x)};makealive.lib.url=function(obj,x){var xargs=[makealive.defArg("url","string","uniform resource locator (URL) holding makealive component data",null),makealive.defArg("makealive","string","makealive conversion function","")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);var xurldata={};var xhr=new XMLHttpRequest;xhr.open("get",x.url,true);xhr.onload=function(){if(xhr.status!==200){throw"Error receiving data: "+xhr.statusText}else{xurldata=JSON.parse(xhr.responseText);for(var name in x){if(x.hasOwnProperty(name)){if(name==="makealive"){if(x.makealive!==""){xurldata[name]=x[name]}}else{xurldata[name]=x[name]}}}makealive.lib[xurldata.makealive](obj,xurldata)}};xhr.send()};makealive.lib.drc01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:series:dose:value","dose-response values",null),makealive.defArg("series","array:series:label:color:radius:linewidth","series definitions",null),makealive.defArg("size","integer:2","size (width, height)",[420,240]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[40,100,50,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1.0em","2.5em","-2.3em"]),makealive.defArg("padding","number","space around points",.2),makealive.defArg("background","number","background level (subtracted from data values)",0),makealive.defArg("bandwidth","number","bandwidth for curve smoothing ([0, 1])",.15),makealive.defArg("points","integer","display points (0:hide, 1:show)",1),makealive.defArg("legend","integer:3","legend position (x, y, spacing)",[240,20,16]),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["bottom line","left line"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="drc01";var libtools=makealive.libtools;var refdata=x.data.filter(function(d){return+d.dose===0});var drcdata=x.data.filter(function(d){return+d.dose>0});var series=libtools.uniq(libtools.pluck(refdata,"series"));var seriesr={},serieslab={},seriescol={},serieslwd={};for(var i=0;i<x.series.length;i++){seriesr[x.series[i].series]=x.series[i].radius;seriescol[x.series[i].series]=x.series[i].color;serieslwd[x.series[i].series]=x.series[i].linewidth;serieslab[x.series[i].series]=x.series[i].label;x.series[i].id=i}var refseries={};var amean=function(z){var zsum=0;z.forEach(function(x){zsum+=x});return zsum/z.length};for(var i=0;i<series.length;i++){var ivalues=refdata.filter(function(d){return d.series===series[i]}).map(function(d2){return d2.value});refseries[series[i]]=amean(ivalues)}var concs=x.data.map(function(d){return+d.dose});concs=concs.filter(function(cc){return cc>0});var xlim=[Math.min.apply(null,concs),Math.max.apply(null,concs)];xlim[0]=xlim[0]/(1+x.padding);xlim[1]=xlim[1]*(1+x.padding);var bgval=+x.background;var values=x.data.map(function(d){return(+d.value-bgval)/(refseries[d.series]-bgval)});var ylim=[Math.min.apply(null,values),Math.max.apply(null,values)];if(ylim[0]>0){ylim[0]=0}var highlightcurve=function(){var dthis=d3.select(this);dthis.style("opacity",1);var dthisval=dthis.attr("val");svg.selectAll('[val="'+dthisval+'"]').style("opacity",1)};var unhighlightcurve=function(){var dthis=d3.select(this);dthis.style("opacity",.8*x.points);var dthisval=dthis.attr("val");svg.selectAll('circle[val="'+dthisval+'"]').style("opacity",.8*x.points);svg.selectAll('path[val="'+dthisval+'"]').style("opacity",.8);svg.selectAll("circle.legend").style("opacity",.8);svg.selectAll("text.legend").style("opacity",1)};libtools.dims(x);var svg=libtools.d3svg(obj,x);var yscale=d3.scaleLinear().range([x.hinner,0]).domain(ylim);var yaxis=d3.axisLeft(yscale).ticks(4);libtools.d3yaxis(svg,x,yaxis);var xscale=d3.scaleLog().base(10).range([0,x.winner]).domain(xlim);var xaxis=d3.axisBottom(xscale).tickFormat(d3.format(".0r"));libtools.d3xaxis(svg,x,xaxis);var xticks=svg.selectAll(".xaxis .tick text");var xratio=xlim[1]/xlim[0];var showTick=function(v){var first=+v.match("[1-9]");if(xratio<20){return first===1||first%2===0}else if(xratio<200){return first===1||first===5}else{return first===1}};xticks.filter(function(){var tickvalue=d3.select(this).text();return!showTick(tickvalue)}).remove();libtools.d3title(svg,x);svg.selectAll(".values").data(drcdata).enter().append("circle").attr("class","scatterdot").attr("fill",x.color).style("opacity",function(d){return.8*x.points}).attr("cx",function(d){return xscale(d.dose)}).attr("cy",function(d){var dserref=refseries[d.series]-bgval;return yscale((d.value-bgval)/dserref)}).attr("r",function(d){return seriesr[d.series]}).attr("fill",function(d){return seriescol[d.series]}).attr("val",function(d){return d.series});var drcline=d3.line().curve(d3.curveBasis).x(function(d){return xscale(d.dose)}).y(function(d){var dserref=refseries[d.series]-bgval;return yscale((d.value-bgval)/dserref)});var smoothseries=function(dseries,logbandwidth){var result=[];for(var j=0;j<dseries.length;j++){var lognowconc=Math.log(dseries[j].dose);var temp=dseries.filter(function(d){var logdconc=Math.log(d.dose);return logdconc>lognowconc-logbandwidth&logdconc<lognowconc+logbandwidth});var temp2=[];for(var k=0;k<temp.length;k++){temp2.push(temp[k].value);if(temp[k].dose===dseries[j].dose){temp2.push(temp[k].value)}}result.push({series:dseries[j].series,dose:dseries[j].dose,value:amean(temp2)})}result.sort(function(a,b){if(a.dose<b.dose)return-1;if(a.dose>b.dose)return 1;return 0});var smoothresult=[];smoothresult.push(result[0]);for(var j=1;j<result.length;j++){if(result[j].dose!==result[j-1].dose){smoothresult.push(result[j])}}return smoothresult};var logbandwidth=+x.bandwidth*Math.log(xlim[1]/xlim[0]);for(var i=0;i<series.length;i++){var iseries=series[i];var iraw=drcdata.filter(function(d){return d.series===series[i]});var ismooth=smoothseries(iraw,logbandwidth);svg.append("path").data([ismooth]).attr("class","line").attr("d",drcline).attr("stroke",seriescol[iseries]).attr("fill","none").attr("val",iseries).attr("stroke-width",serieslwd[iseries]).style("opacity",function(d){return.8}).on("mouseover",highlightcurve).on("mouseout",unhighlightcurve)}svg.selectAll(".legendtext").data(x.series).enter().append("text").html(function(d){return d.label}).attr("x",x.legend[0]).attr("y",function(d){return x.legend[1]+d.id*x.legend[2]}).attr("val",function(d){return d.series}).style("text-anchor","left").style("font-size","10").attr("dx","0.5em").attr("dy","0.25em").attr("class","legend");svg.selectAll(".legendmarker").data(x.series).enter().append("circle").attr("cx",x.legend[0]).attr("cy",function(d){return x.legend[1]+d.id*x.legend[2]}).attr("val",function(d){return d.series}).attr("r",function(d){return seriesr[d.series]}).attr("fill",function(d){return seriescol[d.series]}).attr("class","legend");svg.selectAll(".legend").attr("opacity",1).on("mouseover",highlightcurve).on("mouseout",unhighlightcurve)};makealive.lib.barplot01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:value:fill","contents of bar plot",null),makealive.defArg("size","integer:2","size (width, height)",[200,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[40,20,40,50]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1.5em","2.5em","-2.5em"]),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["bottom","left line"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="barplot01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var xscale=d3.scaleBand().range([0,x.winner]).padding(x.padding).domain(libtools.pluck(x.data,"name"));var xaxis=d3.axisBottom(xscale);libtools.d3xaxis(svg,x,xaxis);var yvalues=libtools.pluck(x.data,"value");yvalues.push(0);var yscale=d3.scaleLinear().range([x.hinner,0]).domain([libtools.min(yvalues),libtools.max(yvalues)]);var yaxis=d3.axisLeft(yscale).ticks(4);libtools.d3yaxis(svg,x,yaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));tooltip.html("<b>"+d.name+":</b> "+d.value).style("left",+x.margin[3]+xscale(d.name)+"px").style("top",-x.size[1]+yscale(libtools.max([0,d.value]))+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0)};svg.selectAll(".bar").data(x.data).enter().append("rect").attr("class","bar").attr("fill",function(d){return libtools.l2(d.fill)}).attr("fillcolor",function(d){return d.fill}).attr("x",function(d){return xscale(d.name)}).attr("width",xscale.bandwidth()).attr("y",function(d){return yscale(libtools.max([0,d.value]))}).attr("height",function(d){return Math.sign(d.value)*(yscale(0)-yscale(d.value))}).on("mouseover",tooltipshow).on("mouseout",tooltiphide)};makealive.lib.stackedbarplot01=function(obj,x){var xargs=[makealive.defArg("title","string","chart title",null),makealive.defArg("xlab","string","x-axis label",null),makealive.defArg("ylab","string","y-axis label",null),makealive.defArg("data","array:name:series:value","contents of bar plot",null),makealive.defArg("series","array:series:label:fill","series labels",null),makealive.defArg("size","integer:2","size (width, height)",[300,200]),makealive.defArg("margin","number:4","margins (top, right, bottom, left)",[40,140,45,55]),makealive.defArg("offset","length:3","label offsets from axis (top, x, y)",["-1.5em","2.5em","-2.5em"]),makealive.defArg("padding","number","space between bars",.2),makealive.defArg("legend","integer:3","legend position (x, y, spacing)",[125,20,16]),makealive.defArg("legendmarker","integer:2","legend marker (width, height, offset)",[15,8,-2]),makealive.defArg("axisstyle","string:2","type of axis (x, y)",["bottom","left line"]),makealive.defArg("axiscolor","string","color of grid lines","#000")];if(obj===null)return xargs;makealive.checkArgs(x,xargs);x.makealive="stackedbarplot01";var libtools=makealive.libtools;libtools.dims(x);var svg=libtools.d3svg(obj,x);libtools.d3title(svg,x);var barnames=libtools.uniq(libtools.pluck(x.data,"name"));var xscale=d3.scaleBand().range([0,x.winner]).padding(x.padding).domain(barnames);var xaxis=d3.axisBottom(xscale);libtools.d3xaxis(svg,x,xaxis);var seriesinfo=libtools.indexBy(x.series,"series");for(var i=0;i<x.series.length;i++){x.series[i]["id"]=i}var namedata=[];for(var i=0;i<barnames.length;i++){var idata=x.data.filter(function(d){return d.name===barnames[i]});idata.sort(function(a,b){return a.series>b.series});var itemp=0;for(var j=0;j<idata.length;j++){idata[j].lower=itemp;itemp+=idata[j].value;idata[j].upper=itemp}namedata[i]=idata}x.data=[];for(var i=0;i<namedata.length;i++){x.data=x.data.concat(namedata[i])}var barmax=libtools.max(libtools.pluck(x.data,"upper"));var yscale=d3.scaleLinear().range([x.hinner,0]).domain([0,barmax]);var yaxis=d3.axisLeft(yscale).ticks(4);libtools.d3yaxis(svg,x,yaxis);var tooltip=d3.select(obj).append("div").attr("class","makealive tooltip");var tooltipshow=function(d){var thisbar=d3.select(this);thisbar.attr("fill",thisbar.attr("fillcolor"));var dlab=seriesinfo[d.series].label;tooltip.html("<b>"+d.name+": "+dlab+": </b> "+d.value).style("left",+x.margin[3]+xscale(d.name)+"px").style("top",-x.h+yscale(d.upper)+"px").style("opacity",.9)};var tooltiphide=function(d){var thisbar=d3.select(this);thisbar.attr("fill",libtools.l2(thisbar.attr("fillcolor")));tooltip.style("opacity",0)};svg.selectAll(".bar").data(x.data).enter().append("rect").attr("class","bar").attr("fill",function(d){return libtools.l2(seriesinfo[d.series].fill)}).attr("fillcolor",function(d){return seriesinfo[d.series].fill}).attr("x",function(d){return xscale(d.name)}).attr("width",xscale.bandwidth()).attr("y",function(d){return yscale(d.upper)}).attr("height",function(d){return-yscale(d.upper)+yscale(d.lower)}).on("mouseover",tooltipshow).on("mouseout",tooltiphide);svg.selectAll(".legendtext").data(x.series).enter().append("text").html(function(d){return d.label}).attr("x",x.legend[0]+x.legendmarker[0]+x.legendmarker[2]).attr("y",function(d){var dpos=x.series.length-d.id-1;return x.legend[1]+dpos*x.legend[2]}).attr("val",function(d){return d.series}).style("text-anchor","left").style("font-size","10").attr("dx","0.5em").attr("dy","0.25em").attr("class","makealive legend");svg.selectAll(".legendmarker").data(x.series).enter().append("rect").attr("x",x.legend[0]).attr("y",function(d){var dpos=x.series.length-d.id-1;return x.legend[1]+dpos*x.legend[2]-x.legendmarker[1]/2}).attr("width",x.legendmarker[0]).attr("height",x.legendmarker[1]).attr("val",function(d){return d.series}).attr("fill",function(d){return seriesinfo[d.series]["fill"]}).attr("class","makealive legend");svg.selectAll(".legend").attr("opacity",1)};makealive.lib.plotly=function(obj,x){var xargs=[makealive.defArg("data","array","data input for Plotly.newPlot",null),makealive.defArg("layout","array","layout settings for Plotly.newPlot",null)];if(obj===null)return xargs;var rn="plotly-"+Math.floor(Math.random()*1e9);obj.setAttribute("id",rn);var cc=0;var checkAndDraw=function(){var plotlydiv=document.getElementById(rn);if(typeof plotlydiv!=="undefined"&&plotlydiv!==null){Plotly.newPlot(rn,x.data,x.layout);return}cc++;if(cc<20){setTimeout(checkAndDraw,100)}else{throw"Error during plotly conversion: timeout"}};checkAndDraw()};
